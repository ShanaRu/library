{"remainingRequest":"D:\\IBM课件和代码\\work\\library\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\IBM课件和代码\\work\\library\\src\\components\\administrator\\returning.vue?vue&type=style&index=0&id=51c63a10&scoped=true&lang=css&","dependencies":[{"path":"D:\\IBM课件和代码\\work\\library\\src\\components\\administrator\\returning.vue","mtime":1606385443740},{"path":"D:\\IBM课件和代码\\work\\library\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\IBM课件和代码\\work\\library\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\IBM课件和代码\\work\\library\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\IBM课件和代码\\work\\library\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\IBM课件和代码\\work\\library\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKDQovKi5lbC1zZWxlY3R7DQogIHdpZHRoOjE2NHB4Ow0KfQ0KLmVsLXJvd3sNCiAgbWFyZ2luLXRvcDoxMHB4Ow0KICB3aWR0aDoxM3B4Ow0KICBtYXJnaW4tbGVmdDo3NSU7DQp9DQouZWwtdGFibGV7DQogIG1hcmdpbi10b3A6MiU7DQogICBtYXJnaW4tbGVmdDoxMCU7DQp9DQouZWwtcGFnaW5hdGlvbnsNCiAgbWFyZ2luLXRvcDoxJTsNCiAgbWFyZ2luLWxlZnQ6MzIlOw0KfQ0KLmVsLWZvcm17DQogIG1hcmdpbi1sZWZ0OjkuMSU7DQogIG1hcmdpbi10b3A6NCU7DQp9DQouYmxvY2sgew0KICAgIHBhZGRpbmctdG9wOjMwcHg7DQp9Ki8NCi5kZW1vLWlucHV0LXN1ZmZpeCB7DQogICAgZmxvYXQ6cmlnaHQ7DQogICAgbWFyZ2luOiAzMHB4IDA7DQp9DQouc2VhcmNoSW5wdXQgew0KICAgIHdpZHRoOiA3MCU7DQogICAgbWFyZ2luLXJpZ2h0OiAyMHB4Ow0KfQ0KLmVsLXBhZ2luYXRpb24gew0KICAgIG1hcmdpbi10b3A6IDIwcHg7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCn0NCg=="},{"version":3,"sources":["returning.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6MA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"returning.vue","sourceRoot":"src/components/administrator","sourcesContent":["<template>\r\n  <div class=\"returning-container\">\r\n\r\n    <!-- <div style=\"margin-top: 15px; width: 300px; margin-left: 52.5%\">\r\n      <el-input placeholder=\"请输入借阅者\" v-model=\"searchUserName\">\r\n        <i slot=\"prefix\" class=\"el-input__icon el-icon-search\"></i>\r\n        <el-button slot=\"append\" @click=\"searchName\">搜索</el-button>\r\n      </el-input>\r\n    </div> -->\r\n    <div class=\"demo-input-suffix\">\r\n        <el-input\r\n            style=\"width:270px\" clearable maxlength=\"30\"\r\n            placeholder=\"请输入用户姓名\"\r\n            v-model=\"searchUserName\" class=\"searchInput\">\r\n            <i slot=\"prefix\" class=\"el-input__icon el-icon-search\"></i>\r\n        </el-input>\r\n        <el-button type=\"primary\" @click=\"searchName\">查询</el-button>\r\n    </div>\r\n\r\n    <el-table style=\"width:100%\" stripe\r\n     :data=\"tableData.slice(0,7)\"\r\n     border>\r\n      <el-table-column prop=\"id\" align=\"center\" label=\"借阅编号\" min-width=\"5%\"></el-table-column>\r\n      <el-table-column prop=\"userInfo.nickname\" align=\"center\" label=\"姓名\" min-width=\"10%\"></el-table-column>\r\n      <el-table-column prop=\"bookId\" align=\"center\" label=\"图书编号\" min-width=\"5%\"></el-table-column>\r\n      <el-table-column prop=\"book.bookName\" align=\"center\" label=\"图书名称\" min-width=\"22%\" show-overflow-tooltip></el-table-column>\r\n      <el-table-column prop=\"book.author\" align=\"center\" label=\"作者\" min-width=\"10%\"></el-table-column>\r\n      <el-table-column prop=\"returnDate\" align=\"center\" label=\"需要归还时间\" min-width=\"10%\">\r\n        <template slot-scope=\"scope\">{{scope.row.returnDate | formatDate}}</template>\r\n      </el-table-column>\r\n      <el-table-column label=\"借阅状态\"  align=\"center\" min-width=\"8%\">\r\n        <template  slot-scope=\"scope\">\r\n          <el-button @click=\"open(scope.row)\" type=\"success\" size=\"small\" plain>归还</el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n\r\n    <!-- 分页 -->\r\n    <div class=\"block\">\r\n            <el-pagination\r\n            @current-change=\"handleCurrentChange\"\r\n            :current-page=\"currentPage\"\r\n            :page-size=\"pagesize\"\r\n            layout=\"total, prev, pager, next,jumper\"\r\n            :total=\"dataLength\">\r\n            </el-pagination>\r\n        </div>\r\n  </div>\r\n</template>\r\n\r\n\r\n<script>\r\nimport axios from 'axios'\r\nimport qs from 'qs'\r\nimport {formatDate} from '../../assets/js/time.js'\r\nexport default {\r\n  name: \"returning\",\r\n  data() {\r\n    return {\r\n      tableData: [],\r\n      searchUserName:\"\",\r\n      dataLength: 0,\r\n\r\n      // 分页\r\n      currentPage: 1, //初始页\r\n      pagesize: 7, //每页的数据\r\n    }\r\n  },\r\n  methods: {\r\n    //判断是否逾期\r\n      isOverdue(returnDate){\r\n          let now = new Date();\r\n          let returnDate1 = new Date(returnDate);\r\n          let nowMill = now.getTime();\r\n          let returnMill = returnDate1.getTime();\r\n          if(returnMill<nowMill){\r\n              return true;\r\n          }else{\r\n              return false;\r\n          }\r\n      },\r\n    open(data) {\r\n      console.log(data);\r\n      this.$confirm(\"是否确定更改图书状态为已归还\", \"提示\", {\r\n        confirmButtonText: \"确定\",\r\n        cancelButtonText: \"取消\",\r\n        type: \"warning\",\r\n      }).then(() => {\r\n        if(!this.isOverdue(data.returnDate)){\r\n          axios({\r\n              url:\"/borrowInfo/returnBook\",\r\n              method: \"put\",\r\n              params:{\r\n                id:data.id\r\n              }\r\n          }).then(response=>{\r\n            this.getBookSelfData(this.currentPage,this.pagesize),\r\n            this.$message({\r\n                type: 'success',\r\n                message: '归还成功',\r\n                showClose:true\r\n            }); \r\n          }).catch(error=>{\r\n              this.$message({\r\n                  type: 'info',\r\n                  message: '归还失败',\r\n                  showClose:true\r\n              }); \r\n          })\r\n        }else {\r\n          this.$message({\r\n              type: 'info',\r\n              message: '该用户存在逾期图书，请先交逾期罚款才能还书',\r\n              showClose:true\r\n          }); \r\n        }\r\n\r\n      }).catch(() => {\r\n          this.$message({\r\n            type: \"info\",\r\n            message: \"已取消归还\",\r\n            showClose:true\r\n          });\r\n      });\r\n    },\r\n    getBookSelfData(currentPage,pageSize) {\r\n            axios({\r\n                    method:'get',\r\n                    url:\"/borrowInfo/fuzzyQuery\",\r\n                    params:{\r\n                        name:this.searchUserName,\r\n                        states :1,\r\n                        currentPage:currentPage,\r\n                        pageSize:pageSize\r\n                    }\r\n            }).then(response => {\r\n                let result = response.data;\r\n                if(result.code == 200) {\r\n                    console.log(result.data);\r\n                    this.tableData = result.data;\r\n                    this.dataLength = result.count;\r\n                    console.log(this.tableData);\r\n                }\r\n            })\r\n            .catch(error => {\r\n                this.$message({\r\n                    showClose: true,\r\n                    message: '系统错误',\r\n                    type: 'error'\r\n                });\r\n            })\r\n        },\r\n\r\n    handleSizeChange(val) {\r\n        this.pagesize = val;\r\n    },\r\n    handleCurrentChange(val) {\r\n        this.currentPage = val;\r\n        this.getBookSelfData(this.currentPage,7);\r\n    },\r\n    searchName(){\r\n        this.currentPage = 1;\r\n            axios({\r\n                 method:'get',\r\n                 url:\"/borrowInfo/fuzzyQuery\",\r\n                 params:{\r\n                     name:this.searchUserName,\r\n                     states:1,\r\n                     currentPage:1,\r\n                     pageSize:this.pagesize\r\n                 }\r\n            }).then(response => {\r\n                let result = response.data;\r\n                if(result.code == 200) {\r\n                    console.log(result.data);\r\n                    this.tableData = result.data;\r\n                    this.dataLength = result.count;\r\n                    console.log(this.tableData);\r\n                }\r\n            })\r\n            .catch(error => {\r\n                this.$message({\r\n                    showClose: true,\r\n                    message: '系统错误',\r\n                    type: 'error'\r\n                });\r\n            })\r\n    },\r\n  },\r\n  created() {\r\n        this.getBookSelfData(1,7);\r\n  },\r\n  //时间过滤器，将TimeStamp类型数据换成自定义格式\r\n  filters: {\r\n    formatDate(time) {\r\n      let date = new Date(time);\r\n      // return formatDate(date, 'yyyy-MM-dd hh:mm');\r\n      return formatDate(date, 'yyyy-MM-dd');\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n\r\n<style scoped>\r\n/*.el-select{\r\n  width:164px;\r\n}\r\n.el-row{\r\n  margin-top:10px;\r\n  width:13px;\r\n  margin-left:75%;\r\n}\r\n.el-table{\r\n  margin-top:2%;\r\n   margin-left:10%;\r\n}\r\n.el-pagination{\r\n  margin-top:1%;\r\n  margin-left:32%;\r\n}\r\n.el-form{\r\n  margin-left:9.1%;\r\n  margin-top:4%;\r\n}\r\n.block {\r\n    padding-top:30px;\r\n}*/\r\n.demo-input-suffix {\r\n    float:right;\r\n    margin: 30px 0;\r\n}\r\n.searchInput {\r\n    width: 70%;\r\n    margin-right: 20px;\r\n}\r\n.el-pagination {\r\n    margin-top: 20px;\r\n    display: flex;\r\n    justify-content: center;\r\n}\r\n</style>"]}]}