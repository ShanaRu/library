{"remainingRequest":"D:\\IBM课件和代码\\work\\library\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\IBM课件和代码\\work\\library\\src\\components\\user\\userLibrary.vue?vue&type=style&index=0&id=4834d43c&scoped=true&lang=css&","dependencies":[{"path":"D:\\IBM课件和代码\\work\\library\\src\\components\\user\\userLibrary.vue","mtime":1606278291157},{"path":"D:\\IBM课件和代码\\work\\library\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\IBM课件和代码\\work\\library\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\IBM课件和代码\\work\\library\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\IBM课件和代码\\work\\library\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\IBM课件和代码\\work\\library\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKDQouZGV0YWlscyBoMXsNCiAgdGV4dC1hbGlnbjogY2VudGVyOw0KfQ0KLmRldGFpbHMgdWx7DQogIGxpc3Qtc3R5bGU6IG5vbmU7DQp9DQouZGV0YWlscyB1bCBsaXsNCiAgZm9udC1zaXplOiAxNnB4Ow0KfQ0KLyouYm94ew0KICBtYXJnaW4tbGVmdDogMTUlOw0KfQ0KLmVsLXNlbGVjdCB7DQogIHdpZHRoOiAxNjRweDsNCn0NCi5lbC1yb3cgew0KICBtYXJnaW4tdG9wOiAyJTsNCiAgd2lkdGg6IDEzcHg7DQogIG1hcmdpbi1sZWZ0OiA3NSU7DQp9DQouZWwtdGFibGUgew0KICBtYXJnaW4tdG9wOiAxJTsNCiAgbWFyZ2luLWxlZnQ6IDE1JTsNCn0NCi5lbC1wYWdpbmF0aW9uIHsNCiAgbWFyZ2luLXRvcDogMSU7DQogIG1hcmdpbi1sZWZ0OiAyNSU7DQp9Ki8NCi5saWJyYXJ5LWNvbnRhaW5lciB7DQogIG1hcmdpbjowIDE1JTsNCn0NCi5lbC1zZWxlY3Qgew0KICB3aWR0aDogMTY0cHg7DQp9DQouZWwtcGFnaW5hdGlvbiB7DQogIG1hcmdpbi10b3A6IDIwcHg7DQogIGRpc3BsYXk6IGZsZXg7DQogIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KfQ0KLmJveCB7DQogIGZsb2F0OiByaWdodDsNCn0NCg=="},{"version":3,"sources":["userLibrary.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6YA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"userLibrary.vue","sourceRoot":"src/components/user","sourcesContent":["<template>\r\n  <div class=\"library-container\">\r\n    <div class=\"box\">\r\n      <el-form :inline=\"true\"  class=\"demo-form-inline\" :model=\"condition\" label-width=\"50px\">\r\n        <el-form-item label=\"国家\">\r\n          <el-select v-model=\"condition.countryId\" placeholder=\"请选择国家\">\r\n            <el-option :label=\"country.countryName\" :value=\"country.id\" v-for=\"country in selectBox.country\" :key=\"country.id\"></el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"类型\" >\r\n          <el-select v-model=\"condition.typeId\" placeholder=\"请选择书籍类型\">\r\n              <el-option :label=\"type.typeName\" :value=\"type.id\" v-for=\"type in selectBox.type\" :key=\"type.id\"></el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"篇幅\">\r\n          <el-select v-model=\"condition.space\" placeholder=\"请选择书籍篇幅\">\r\n            <el-option v-for=\"item in spaces\" :key=\"item.id\" :label=\"item.name\" :value=\"item.id\"></el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"主题\">\r\n          <el-select v-model=\"condition.themeId\" placeholder=\"请选择书籍主题\">\r\n             <el-option :label=\"theme.themeName\" :value=\"theme.id\" v-for=\"theme in selectBox.theme\" :key=\"theme.id\"></el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item style=\"margin-left:25px;margin-right:0\">\r\n          <el-button type=\"primary\" @click=\"onSubmit\">查询</el-button>\r\n          <el-button @click=\"resetForm\"  style=\"margin-left:25px;\">重置</el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n\r\n    <div class=\"box\" style=\"height:60px;float:right\">\r\n        <el-input placeholder=\"请输入图书名称\" v-model=\"searchBookName\" style=\"width:270px;\" clearable  maxlength=\"30\"></el-input>\r\n        <el-button type=\"primary\" @click=\"searchBook\" style=\"margin-left:25px\">搜索</el-button>\r\n    </div>\r\n\r\n    <el-table\r\n      :data=\"tableData.slice(0,7)\" border stripe style=\"100%\">\r\n      <el-table-column fixed prop=\"id\" label=\"图书编号\" min-width=\"5%\" align=\"center\">\r\n      </el-table-column>\r\n      <el-table-column prop=\"bookName\" label=\"图书名称\" min-width=\"15%\" align=\"center\">\r\n      </el-table-column>\r\n      <el-table-column prop=\"author\" label=\"作者\" min-width=\"10%\" align=\"center\">\r\n      </el-table-column>\r\n      <el-table-column prop=\"type.typeName\" label=\"类型\" min-width=\"5%\" align=\"center\"> </el-table-column>\r\n      <el-table-column prop=\"country.countryName\" label=\"国家\" min-width=\"5%\" align=\"center\">\r\n      </el-table-column>\r\n      <el-table-column prop=\"createDate\" label=\"上架日期\" min-width=\"8%\" align=\"center\">\r\n        <template slot-scope=\"scope\">{{scope.row.createDate | formatDate}}</template>\r\n      </el-table-column>\r\n      <el-table-column prop=\"bookCount\" label=\"剩余数量\" min-width=\"5%\" align=\"center\"> </el-table-column>\r\n      <el-table-column label=\"操作\" min-width=\"10%\" align=\"center\">\r\n        <template slot-scope=\"scope\">\r\n          <el-button @click=\"open(scope.row)\" type=\"success\" plain size=\"small\">借阅</el-button>\r\n          <el-button type=\"primary\" @click=\"handleOpen(scope.row)\" plain size=\"small\">详情</el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n\r\n    <el-dialog\r\n      title=\"图书详情\"\r\n      :visible.sync=\"dialogVisible\"\r\n      width=\"50%\" center\r\n      class=\"details\">\r\n      <h1 style=\"text-align:center\">{{details.bookName}}</h1>\r\n      <ul>\r\n        <li><p>书籍编号：{{details.id}}</p></li>\r\n        <li><p>书籍名称：{{details.bookName}}</p></li>\r\n        <li><p>上架时间：{{details.createDate | formatDate}}</p></li>\r\n        <li v-if=\"details.type!=undefined\"><p>类型：{{details.type.typeName}}</p></li>\r\n        <li v-if=\"details.theme!=undefined\"><p>主题：{{details.theme.themeName}}</p></li>\r\n        <li v-if=\"details.country != undefined\"><p>国家：{{details.country.countryName}}</p></li>\r\n        <li><p>篇幅：{{details.space}}</p></li>\r\n        <li><p style=\"line-height:30px\">详细信息：{{details.info}}</p></li>\r\n      </ul>\r\n      <!-- <h2>借阅记录</h2>\r\n      <el-table\r\n      :data=\"bookHistory\"\r\n      border\r\n      stripe\r\n      style=\"width: 70%;margin-left:0\">\r\n      <el-table-column fixed prop=\"id\" label=\"借阅编号\" width=\"150\">\r\n      </el-table-column>\r\n      <el-table-column fixed prop=\"userInfo.nickname\" label=\"借阅人\" width=\"150\">\r\n      </el-table-column>\r\n      <el-table-column prop=\"borrowDate\" label=\"借阅日期\" width=\"200\">\r\n      </el-table-column>\r\n      <el-table-column prop=\"returnDate\" label=\"还书时间\" width=\"150\">\r\n      </el-table-column>\r\n    </el-table> -->\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button type=\"primary\" @click=\"dialogVisible = false\"\r\n          >关闭</el-button>\r\n      </span>\r\n    </el-dialog>\r\n\r\n    <el-pagination\r\n      class=\"bookPagination\"\r\n      @current-change=\"handleCurrentChange\"\r\n      :current-page=\"currentPage\"\r\n      :page-size=\"pageSize\"\r\n      layout=\"total,prev,pager,next,jumper\"\r\n      :total=\"totalLength\"\r\n    >\r\n    </el-pagination>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Axios from 'axios';\r\nimport qs from 'qs'\r\nimport {formatDate} from '../../assets/js/time.js';\r\nexport default {\r\n  name: \"library\",\r\n  data() {\r\n    return {\r\n      flag:0,//0为名字搜索，1为条件搜索\r\n      totalLength:0,\r\n      dialogVisible: false,\r\n      searchBookName: \"\",\r\n      selectBox: {\r\n        country:[],\r\n        theme:[],\r\n        type:[],\r\n        space:[]\r\n      },\r\n      tableData: [],\r\n      currentPage: 1, //初始页\r\n      pageSize: 7, //    每页的数据\r\n      condition:{\r\n        countryId:null,\r\n        themeId:null,\r\n        typeId:null,\r\n        space:null\r\n      },\r\n      spaces:[\r\n        {\r\n          id:1,\r\n          name:\"短篇\"\r\n        },\r\n        {\r\n          id:2,\r\n          name:\"中篇\"\r\n        },\r\n        {\r\n          id:3,\r\n          name:\"长篇\"\r\n        }\r\n\r\n      ],\r\n      details:{},\r\n      bookHistory:[]\r\n    }\r\n  },\r\n  methods: {\r\n    \r\n    handleOpen(row){\r\n      this.dialogVisible = true;\r\n      this.details = row;\r\n      Axios({\r\n        method:'get',\r\n        url:\"/borrowInfo/bookHistory\",\r\n        params: {\r\n          bookId:Number.parseInt(row.id)\r\n        }\r\n      })\r\n      .then(response => {\r\n        let result = response.data;\r\n        if(result.code == 200) {\r\n          this.bookHistory = result.data;\r\n        }\r\n      })\r\n      .catch(error => {\r\n        this.$message({\r\n              showClose: true,\r\n              message: '错误',\r\n              type: 'error'\r\n        });\r\n      })\r\n    },\r\n    searchBook() {\r\n      this.flag=0;\r\n      this.currentPage=1;\r\n      this.searchByName();\r\n    },\r\n    searchByName(){\r\n      Axios({\r\n        method:'post',\r\n        url:\"/book/query\",\r\n        data: qs.parse({\r\n          currentPage:this.currentPage,\r\n          pageSize:this.pageSize,\r\n          nickname:this.searchBookName\r\n        })\r\n      })\r\n      .then(response => {\r\n        let result = response.data;\r\n        this.totalLength = result.count;\r\n        this.tableData = result.data;\r\n      })\r\n      .catch(error => {\r\n        this.$message({\r\n              showClose: true,\r\n              message: '错误',\r\n              type: 'error'\r\n        });\r\n      })\r\n    },\r\n    open(row) {\r\n      this.$confirm(\"是否确定借阅此书\", \"提示\", {\r\n        confirmButtonText: \"确定\",\r\n        cancelButtonText: \"取消\",\r\n        type: \"warning\",\r\n      })\r\n        .then(() => {\r\n          Axios({\r\n            method:'post',\r\n            url:\"/borrowInfo\",\r\n            data: qs.parse({\r\n              userId:Number.parseInt(sessionStorage.getItem('userId')),\r\n              bookId:row.id\r\n            })\r\n          })\r\n          .then(response => {\r\n            let result = response.data;\r\n            if(result.code == 200){\r\n              this.$message({\r\n                type: \"success\",\r\n                message: \"借阅成功!\",\r\n                showClose: true\r\n              });\r\n              // row.bookCount = row.bookCount-1;\r\n              this.getLibraryData(this.currentPage,this.pageSize);\r\n            }else{\r\n              this.$message({\r\n                  showClose: true,\r\n                  message: '书籍数量不足或用户借阅数量达到限制或信用分不足',\r\n                  type: 'error'\r\n            });\r\n            }\r\n          })\r\n          .catch(error => {\r\n            this.$message({\r\n                  showClose: true,\r\n                  message: '系统错误',\r\n                  type: 'error'\r\n            });\r\n          })\r\n        })\r\n        .catch(() => {\r\n          this.$message({\r\n            type: \"info\",\r\n            message: \"已取消借阅\",\r\n            showClose: true\r\n          });\r\n        });\r\n    },\r\n    \r\n    searchCondition(){\r\n      Axios({\r\n        method:'post',\r\n        url:\"/book/query\",\r\n        data: qs.parse({\r\n          currentPage:this.currentPage,\r\n          pageSize:this.pageSize,\r\n          country_id:this.condition.countryId,\r\n          theme_id:this.condition.themeId,\r\n          type_id:this.condition.typeId,\r\n          space:this.condition.space,\r\n          nickname:\"\"\r\n        })\r\n      })\r\n      .then(response => {\r\n        let result = response.data;\r\n        this.totalLength = result.count;\r\n        this.tableData = result.data;\r\n        console.log(response);\r\n      })\r\n      .catch(error => {\r\n        this.$message({\r\n              showClose: true,\r\n              message: '错误',\r\n              type: 'error'\r\n        });\r\n      })\r\n    },\r\n    onSubmit() {\r\n      this.flag=1;\r\n      this.currentPage = 1\r\n      this.searchCondition();\r\n    },\r\n    handleCurrentChange: function (currentPage) {\r\n      this.currentPage = currentPage;\r\n       if(this.flag == 0){\r\n          this.searchByName();\r\n       }else{\r\n          this.searchCondition();\r\n       }\r\n    },\r\n    getLibraryData(currentPage,pageSize) {\r\n      Axios({\r\n        method:'post',\r\n        url:\"/book/query\",\r\n        data: qs.parse({\r\n          currentPage:currentPage,\r\n          pageSize:pageSize,\r\n          nickname:this.searchBookName,\r\n        })\r\n      })\r\n      .then(response => {\r\n        let result = response.data;\r\n        this.totalLength = result.count;\r\n        this.tableData = result.data;\r\n      })\r\n      .catch(error => {\r\n        this.$message({\r\n              showClose: true,\r\n              message: '错误',\r\n              type: 'error'\r\n        });\r\n      })\r\n    },\r\n    getCountries(){\r\n      Axios({\r\n        method:'get',\r\n        url:\"/country\"\r\n      })\r\n      .then(response => {\r\n        let result = response.data;\r\n        this.selectBox.country = result.data;\r\n      })\r\n      .catch(error => {\r\n        this.$message({\r\n              showClose: true,\r\n              message: '错误',\r\n              type: 'error'\r\n        });\r\n      })\r\n    },\r\n    getThemes(){\r\n      Axios({\r\n        method:'get',\r\n        url:\"/theme\"\r\n      })\r\n      .then(response => {\r\n        let result = response.data;\r\n        this.selectBox.theme = result.data;\r\n      })\r\n      .catch(error => {\r\n        this.$message({\r\n              showClose: true,\r\n              message: '错误',\r\n              type: 'error'\r\n        });\r\n      })\r\n    },\r\n    getTypes(){\r\n      Axios({\r\n        method:'get',\r\n        url:\"/type\"\r\n      })\r\n      .then(response => {\r\n        let result = response.data;\r\n        this.selectBox.type = result.data;\r\n      })\r\n      .catch(error => {\r\n        this.$message({\r\n              showClose: true,\r\n              message: '错误',\r\n              type: 'error'\r\n        });\r\n      })\r\n    },\r\n    resetForm() {\r\n      this.condition.countryId=null;\r\n      this.condition.themeId=null;\r\n      this.condition.typeId=null;\r\n      this.condition.space=null;\r\n    }\r\n  },\r\n  created() {\r\n    this.getCountries();\r\n    this.getThemes();\r\n    this.getTypes();\r\n    this.getLibraryData(1,this.pageSize);\r\n  },\r\n  //时间过滤器，将TimeStamp类型数据换成自定义格式\r\n    filters: {\r\n      formatDate(time) {\r\n        let date = new Date(time);\r\n        return formatDate(date, 'yyyy-MM-dd');\r\n      }\r\n    }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.details h1{\r\n  text-align: center;\r\n}\r\n.details ul{\r\n  list-style: none;\r\n}\r\n.details ul li{\r\n  font-size: 16px;\r\n}\r\n/*.box{\r\n  margin-left: 15%;\r\n}\r\n.el-select {\r\n  width: 164px;\r\n}\r\n.el-row {\r\n  margin-top: 2%;\r\n  width: 13px;\r\n  margin-left: 75%;\r\n}\r\n.el-table {\r\n  margin-top: 1%;\r\n  margin-left: 15%;\r\n}\r\n.el-pagination {\r\n  margin-top: 1%;\r\n  margin-left: 25%;\r\n}*/\r\n.library-container {\r\n  margin:0 15%;\r\n}\r\n.el-select {\r\n  width: 164px;\r\n}\r\n.el-pagination {\r\n  margin-top: 20px;\r\n  display: flex;\r\n  justify-content: center;\r\n}\r\n.box {\r\n  float: right;\r\n}\r\n</style>"]}]}