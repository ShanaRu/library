{"remainingRequest":"D:\\IBM课件和代码\\work\\library\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\IBM课件和代码\\work\\library\\src\\components\\administrator\\importAndExport.vue?vue&type=style&index=0&id=705d4924&scoped=true&lang=css&","dependencies":[{"path":"D:\\IBM课件和代码\\work\\library\\src\\components\\administrator\\importAndExport.vue","mtime":1606384975469},{"path":"D:\\IBM课件和代码\\work\\library\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\IBM课件和代码\\work\\library\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\IBM课件和代码\\work\\library\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\IBM课件和代码\\work\\library\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\IBM课件和代码\\work\\library\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKDQouY2hvc2UtZmlsZXsNCiAgZmxvYXQ6IGxlZnQ7DQp9DQoudXBsb2FkLWNvbnRhaW5lcnsNCiAgbWFyZ2luLXRvcDogMDsNCiAgd2lkdGg6IDYwJTsNCiAgbWFyZ2luLWJvdHRvbTo4MHB4Ow0KfQ0KLmVsLXVwbG9hZF9fdGlwew0KICBmb250LXNpemU6IDE1cHg7DQp9DQouaW5saW5lLWJsb2NrIHsNCiAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KfQ0KLmltcG9ydEJ1dHRvbnsNCiAgbWFyZ2luLXRvcDogMDsNCiAgbWFyZ2luLWxlZnQ6IDEwcHg7DQogIG1hcmdpbi1yaWdodDogNSU7DQp9DQouRXhwb3J0QnV0dG9uew0KICBtYXJnaW4tbGVmdDogNSU7DQp9DQouZWwtcGFnaW5hdGlvbiB7DQogICAgbWFyZ2luLXRvcDogMzBweDsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KfQ0K"},{"version":3,"sources":["importAndExport.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2UA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"importAndExport.vue","sourceRoot":"src/components/administrator","sourcesContent":["<template>\r\n  <div class=\"importAndExport-container\">\r\n    <div class=\"selectBox\">\r\n        <el-form :inline=\"true\" class=\"demo-form-inline\">\r\n            <el-form-item label=\"国家\">\r\n            <el-select v-model=\"country\">\r\n                <el-option v-for=\"item in defaultData\" :label=\"item.defaultName\" :value=\"item.id\" v-bind:key=\"item.id\"></el-option>\r\n                <el-option v-for=\"item in countryData \" :label=\"item.countryName\" :value=\"item.id\" v-bind:key=\"item.id\"></el-option>\r\n            </el-select>\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"类型\">\r\n            <el-select v-model=\"type\">\r\n                <el-option v-for=\"item in defaultData\" :label=\"item.defaultName\" :value=\"item.id\" v-bind:key=\"item.id\"></el-option>\r\n                <el-option v-for=\"item in typeData \" :label=\"item.typeName\" :value=\"item.id\" v-bind:key=\"item.id\"></el-option>\r\n            </el-select>\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"篇幅\">\r\n            <el-select v-model=\"space\">\r\n                <el-option v-for=\"item in spaceData\" :label=\"item.spaceName\" :value=\"item.id\" v-bind:key=\"item.id\"></el-option>\r\n            </el-select>\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"主题\">\r\n            <el-select v-model=\"theme\">\r\n                <el-option v-for=\"item in defaultData\" :label=\"item.defaultName\" :value=\"item.id\" v-bind:key=\"item.id\"></el-option>\r\n                <el-option v-for=\"item in themeData \" :label=\"item.themeName\" :value=\"item.id\" v-bind:key=\"item.id\"></el-option>\r\n            </el-select>\r\n            </el-form-item>\r\n            <el-form-item>\r\n              <el-button type=\"primary\" @click=\"query\" style=\"margin-left:38px;\">查询</el-button>\r\n              <el-button @click=\"reset\" style=\"margin-left:22px;\">重置</el-button>\r\n            </el-form-item>\r\n        </el-form>\r\n    </div>\r\n    <div class=\"upload-container\">\r\n        <div class=\"chose-file\">\r\n          <el-upload\r\n          class=\"upload inline-block\"\r\n          action=\"\"\r\n          :on-exceed=\"handleExceed\"\r\n          :on-remove=\"handleRemove\"\r\n          :on-change=\"handleChange\"\r\n          :limit=\"1\"\r\n          :auto-upload=\"false\"\r\n          accept=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel\"\r\n          :file-list=\"fileList\">\r\n              <el-button size=\"large\" type=\"primary\">选取文件</el-button>\r\n              <div slot=\"tip\" class=\"el-upload__tip\">只能导入xls/xlsx文件</div>  \r\n          </el-upload>\r\n        </div>\r\n        <el-button class=\"importButton\" size=\"large\" type=\"success\" @click=\"importExcel\">导入数据</el-button>\r\n        <a :href=\"getHref()\">\r\n          <el-button class=\"ExportButton\" size=\"large\" type=\"warning\" >\r\n              导出数据\r\n          </el-button>\r\n        </a>\r\n    </div>\r\n    <el-table :data=\"tableData.slice(0,7)\" border stripe style=\"width: 100%;\" class=\"Excel-table\">\r\n        <el-table-column prop=\"id\" label=\"图书编号\" min-width=\"5%\" align=\"center\">\r\n        </el-table-column>\r\n        <el-table-column prop=\"bookName\" label=\"图书名称\" min-width=\"15%\" align=\"center\" show-overflow-tooltip>\r\n        </el-table-column>\r\n        <el-table-column prop=\"author\" label=\"作者\" min-width=\"10%\" align=\"center\" show-overflow-tooltip>\r\n        </el-table-column>\r\n        <el-table-column prop=\"country.countryName\" label=\"国家\" min-width=\"5%\" align=\"center\">\r\n        </el-table-column>\r\n        <el-table-column prop=\"type.typeName\" label=\"类型\" min-width=\"5%\" align=\"center\"> </el-table-column>\r\n        <el-table-column prop=\"theme.themeName\" label=\"主题\" min-width=\"5%\" align=\"center\">\r\n        </el-table-column>\r\n        <el-table-column prop=\"space\" label=\"篇幅\" min-width=\"5%\" align=\"center\">\r\n        </el-table-column>\r\n        <el-table-column prop=\"bookCount\" label=\"图书数量\" min-width=\"5%\" align=\"center\">\r\n        </el-table-column>\r\n        <el-table-column prop=\"createDate\" label=\"上架日期\" min-width=\"8%\" align=\"center\">\r\n            <template slot-scope=\"scope\">{{scope.row.createDate | formatDate}}</template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"info\" label=\"简介\" min-width=\"20%\" show-overflow-tooltip align=\"center\">\r\n        </el-table-column>\r\n    </el-table>\r\n    <el-pagination @current-change=\"handleCurrentChange\"\r\n        @size-change=\"handleSizeChange\"\r\n        :current-page=\"currentPage\"\r\n        :page-size=\"pagesize\"\r\n        layout=\"total,prev,pager,next\" :total=\"dataLength\">\r\n    </el-pagination>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios'\r\nimport qs from 'qs'\r\nimport {formatDate} from '../../assets/js/time.js'\r\nexport default {\r\n    name:\"importAndExport\",\r\n    created() {\r\n        this.getBookData(1,7);\r\n        this.getCountryData();\r\n        this.getThemeData();\r\n        this.getTypeData();\r\n    },\r\n    data(){\r\n      return{\r\n          file:[{\r\n            name:\"\",\r\n            url:\"\",\r\n          }],\r\n          currentPage: 1, //初始页\r\n          pagesize: 7, //    每页的数据\r\n          fileTemp:[],\r\n          fileList:[],\r\n          tableData: [],\r\n          countryData: [],\r\n          themeData: [],\r\n          typeData: [],\r\n          defaultData:[{\"id\":0,\"defaultName\":\"默认\"}],\r\n          spaceData:[\r\n                  {\"id\":0,\"spaceName\":\"默认\"},\r\n                  {\"id\":1,\"spaceName\":\"短篇\"},\r\n                  {\"id\":2,\"spaceName\":\"中篇\"},\r\n                  {\"id\":3,\"spaceName\":\"长篇\"},\r\n          ],\r\n          country:0,\r\n          type:0,\r\n          theme:0,\r\n          space:0,\r\n          dataLength:0,\r\n          name:\"\",\r\n      }\r\n    },\r\n    methods:{\r\n        handleChange(file,fileList){\r\n            this.fileTemp = file.raw;\r\n        },\r\n        handleRemove(file,fileList){\r\n            this.fileTemp = null;\r\n        },\r\n        handleExceed(file,fileList){\r\n            this.$message.warning(\r\n              `当前限制选择 1 个文件，本次选择了 ${files.length} 个文件\r\n              ，共选择了 ${files.length + fileList.length} 个文件`);\r\n        },\r\n        handleSizeChange(val) {\r\n                this.pagesize = val;\r\n        },\r\n        handleCurrentChange(val) {\r\n                this.currentPage = val;\r\n                this.getBookData(this.currentPage,7);\r\n        },\r\n        importExcel(){\r\n            console.log(this.fileTemp);\r\n            if(this.fileTemp.length!=0){\r\n                if((this.fileTemp.type == 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet')\r\n                    ||this.fileTemp.type == 'application/vnd.ms-excel'){\r\n                        let form = new FormData();\r\n                        form.append(\"file\",this.fileTemp);\r\n                        let config = {\r\n                            headers:{\r\n                                'Content-type': 'multipart/form-data'\r\n                            },\r\n                        }\r\n                        axios.post('/import',form,config).then(response=>{\r\n                            this.$message({\r\n                              showClose: true,\r\n                              message: '导入成功',\r\n                              type: 'success'\r\n                            });\r\n                        }).catch(error=>{\r\n                            this.$message({\r\n                              showClose: true,\r\n                              message: '导入错误',\r\n                              type: 'error'\r\n                            });\r\n                        })\r\n                  }else{\r\n                      this.$message({\r\n                          showClose: true,\r\n                          message: '导入文件格式不正确，请删除后重新上传',\r\n                          type: 'error'\r\n                      });\r\n                  }\r\n            }else{\r\n                this.$message({\r\n                    showClose: true,\r\n                    message: '请上传附件',\r\n                    type: 'error'\r\n                });\r\n            }\r\n        },\r\n        getBookData(currentPage,pageSize){\r\n                axios({\r\n                    method:'post',\r\n                    url:\"/book/query\",\r\n                    data:qs.parse({\r\n                        currentPage:currentPage,\r\n                        pageSize:pageSize,\r\n                        country_id:this.country,\r\n                        theme_id:this.theme,\r\n                        type_id:this.type,\r\n                        space:this.space\r\n                    })\r\n                }).then(response=>{\r\n                    let result = response.data;\r\n                    if(result.code == 999) {\r\n                        // console.log(result.data);\r\n                        this.tableData = result.data;\r\n                        this.dataLength = result.count;\r\n                        // console.log(this.tableData);\r\n                    }\r\n                }).catch(error=>{\r\n                    this.$message({\r\n                        showClose: true,\r\n                        message: '系统错误',\r\n                        type: 'error'\r\n                    });\r\n                })\r\n            },\r\n            getCountryData(){\r\n                axios({\r\n                    method:'get',\r\n                    url:\"/country\",\r\n                }).then(response => {\r\n                    let result = response.data;\r\n                    if(result.code == 200) {\r\n                        // console.log(result.data);\r\n                        this.countryData = result.data;\r\n                        // console.log(this.countryData);\r\n                    }\r\n                 })\r\n                .catch(error => {\r\n                    this.$message({\r\n                        showClose: true,\r\n                        message: '系统错误',\r\n                        type: 'error'\r\n                    });\r\n                })\r\n            },\r\n            getThemeData(){\r\n                axios({\r\n                    method:'get',\r\n                    url:\"/theme\",\r\n                }).then(response => {\r\n                    let result = response.data;\r\n                    if(result.code == 200) {\r\n                        // console.log(result.data);\r\n                        this.themeData = result.data;\r\n                        // console.log(this.themeData);\r\n                    }\r\n                 })\r\n                .catch(error => {\r\n                    this.$message({\r\n                        showClose: true,\r\n                        message: '系统错误',\r\n                        type: 'error'\r\n                    });\r\n                })\r\n            },\r\n            getTypeData(){\r\n                axios({\r\n                    method:'get',\r\n                    url:\"/type\",\r\n                }).then(response => {\r\n                    let result = response.data;\r\n                    if(result.code == 200) {\r\n                        // console.log(result.data);\r\n                        this.typeData = result.data;\r\n                        // console.log(this.typeData);\r\n                    }\r\n                 })\r\n                .catch(error => {\r\n                    this.$message({\r\n                        showClose: true,\r\n                        message: '系统错误',\r\n                        type: 'error'\r\n                    });\r\n                })\r\n            },\r\n             query() {\r\n                this.currentPage = 1;\r\n                axios({\r\n                    url:\"/book/query\",\r\n                    method: \"post\",\r\n                    data:qs.parse({\r\n                        currentPage:this.currentPage,\r\n                        pageSize:this.pagesize,\r\n                        country_id:this.country,\r\n                        theme_id:this.theme,\r\n                        type_id:this.type,\r\n                        space:this.space\r\n                    })\r\n                }).then(response=>{\r\n                    let result = response.data;\r\n                    if(result.code == 999) {\r\n                        // console.log(result.data);\r\n                        this.tableData = result.data;\r\n                        this.dataLength = result.count;\r\n                        // console.log(this.tableData);\r\n                    }\r\n                }).catch(error=>{\r\n                    this.$message({\r\n                        showClose: true,\r\n                        message: '系统错误',\r\n                        type: 'error'\r\n                    });\r\n                })\r\n            },\r\n            reset(){\r\n                this.currentPage=1;\r\n                this.space=0;\r\n                this.type=0;\r\n                this.theme=0;\r\n                this.country=0;\r\n                this.getBookData(this.currentPage,this.pagesize);\r\n            },\r\n            getHref(){\r\n                return \"http://192.168.3.49:8089/library/export?country_id=\"\r\n                        +this.country+\"&theme_id=\"+this.theme+\"&type_id=\"+this.type+\"&space=\"+this.space+\"&name=\"+this.name;\r\n            }\r\n    },\r\n    filters: {\r\n      formatDate(time) {\r\n          let date = new Date(time);\r\n          // return formatDate(date, 'yyyy-MM-dd hh:mm');\r\n          return formatDate(date, 'yyyy-MM-dd');\r\n      }\r\n    }   \r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.chose-file{\r\n  float: left;\r\n}\r\n.upload-container{\r\n  margin-top: 0;\r\n  width: 60%;\r\n  margin-bottom:80px;\r\n}\r\n.el-upload__tip{\r\n  font-size: 15px;\r\n}\r\n.inline-block {\r\n  display: inline-block;\r\n}\r\n.importButton{\r\n  margin-top: 0;\r\n  margin-left: 10px;\r\n  margin-right: 5%;\r\n}\r\n.ExportButton{\r\n  margin-left: 5%;\r\n}\r\n.el-pagination {\r\n    margin-top: 30px;\r\n    display: flex;\r\n    justify-content: center;\r\n}\r\n</style>"]}]}